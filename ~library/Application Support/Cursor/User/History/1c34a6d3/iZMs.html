<!DOCTYPE html>
<html>
<head>
<title>SuperYoutube</title>
<style>
body {
font-family: Arial, sans-serif;
background-color: #1a1a1a;
color: #ffffff;
margin: 0;
padding: 20px;
}

h1 {
color: #ff4500;
text-align: center;
font-size: 32px;
margin-bottom: 30px;
}

form {
max-width: 600px;
margin: 0 auto;
background-color: #2a2a2a;
padding: 20px;
border-radius: 8px;
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

label {
display: block;
margin-bottom: 10px;
color: #cccccc;
}

input[type="text"] {
width: 100%;
padding: 10px;
border-radius: 4px;
border: 1px solid #444444;
background-color: #333333;
color: #ffffff;
font-size: 16px;
}

button {
background-color: #ff4500;
color: #ffffff;
padding: 10px 20px;
border: none;
border-radius: 4px;
cursor: pointer;
font-size: 16px;
margin-top: 10px;
transition: background-color 0.3s ease;
}

button:hover {
background-color: #ff6a33;
}

#embedContainer {
margin-top: 30px;
width: 100%;
max-width: 1000px;
margin-left: auto;
margin-right: auto;
}

iframe {
width: 100%;
aspect-ratio: 16 / 9;
border: none;
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
</style>
</head>
<body>
<h1>SuperYoutube</h1>

<form id="embedForm">
<label for="youtubeURL">Enter YouTube URL:</label>
<input type="text" id="youtubeURL" name="youtubeURL" placeholder="Paste YouTube URL here">
<button type="button" onclick="embedVideo()">Embed Video</button>
</form>

<div id="embedContainer"></div>

<script>
function embedVideo() {
const youtubeURL = document.getElementById('youtubeURL').value;
const embedURL = youtubeURL.replace('watch?v=', 'embed/');

const iframeHTML = `
<iframe
id="youtubeEmbed"
src="${embedURL}"
title="Embedded YouTube Video"
frameborder="0"
allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
allowfullscreen
></iframe>
`;

document.getElementById('embedContainer').innerHTML = iframeHTML;

// Reset SponsorBlock and set up for the new video
reset();
setup();
}

/* START OF SETTINGS */

// https://wiki.sponsor.ajay.app/w/Types
const categories = [
"sponsor",
"selfpromo",
"interaction",
"intro",
"outro",
"preview",
"music_offtopic",
"exclusive_access",
"poi_highlight",
]
const actionTypes = ["skip", "mute", "full", "poi"]
const skipThreshold = [0.2, 1] // skip from between time-[0] and time+[1]
const serverEndpoint = "https://sponsor.ajay.app"
const skipTracking = true
const highlightKey = "Enter"
// https://developer.mozilla.org/en-US/docs/Web/API/UI_Events/Keyboard_event_key_values

/* END OF SETTINGS */
/* sb.js - SponsorBlock for restrictive environments - by mchangrh

https://github.com/mchangrh/sb.js

Uses SponsorBlock data licensed used under CC BY-NC-SA 4.0 from https://sponsor.ajay.app/

LICENCED UNDER LGPL-3.0-or-later */
const VERSION = "1.3.2" // version constant

// initial setup
let video, videoID, muteEndTime
let skipSegments = new Map()
let muteSegments = new Map()

// functions
const getVideoID = () => {
const iframe = document.querySelector('#youtubeEmbed');
if (iframe) {
const src = iframe.getAttribute('src');
const url = new URL(src);
return url.pathname.split('/').pop();
}
return null;
}

function getJSON(url, callback) {
const xhr = new XMLHttpRequest()
xhr.open("GET", url)
xhr.responseType = "json"
xhr.onload = () => xhr.status == 200 ? callback(null, xhr.response) : callback(xhr.status)
xhr.send()
}

const trackSkip = uuid => {
if (!skipTracking) return
const xhr = new XMLHttpRequest()
xhr.open("POST", `${serverEndpoint}/api/viewedVideoSponsorTime?UUID=${uuid}`)
xhr.send()
}

function fetch(videoID) {
const url = `${serverEndpoint}/api/skipSegments?videoID=${videoID}&categories=${JSON.stringify(categories)}&actionTypes=${JSON.stringify(actionTypes)}`
const convertSegment = s => [s.segment[0], { end: s.segment[1], uuid: s.UUID }]
getJSON(url, (err, data) => {
if (err) return console.error("[SB.js]", "error fetching segments", err)
data.forEach(s => {
if (s.actionType === "skip") skipSegments.set(...convertSegment(s))
else if (s.actionType === "mute") muteSegments.set(...convertSegment(s))
else if (s.actionType === "full") createVideoLabel(s)
else if (s.actionType === "poi") createPOILabel(s)
})
console.log("[SB.js] Loaded Segments")
})
}

function setup() {
const newVideoID = getVideoID();
if (videoID === newVideoID) return; // already running correctly
console.log(`@mchangrh/SB.js ${VERSION} Loaded`);
console.log(`Uses SponsorBlock data licensed used under CC BY-NC-SA 4.0 from https://sponsor.ajay.app/`);

videoID = newVideoID;
if (!videoID) return console.log("[SB.js] no video ID found");

fetch(videoID);

// Use postMessage to control the iframe
window.addEventListener('message', handleYouTubeMessage);
}

function handleYouTubeMessage(event) {
if (event.source !== document.querySelector('#youtubeEmbed').contentWindow) return;

const data = JSON.parse(event.data);
if (data.event === 'onStateChange' && data.info === 1) {
// Video is playing
skipOrMute();
}
}

function skipOrMute() {
const iframe = document.querySelector('#youtubeEmbed');
if (!iframe) return;

iframe.contentWindow.postMessage(JSON.stringify({
event: 'command',
func: 'getCurrentTime',
args: []
}), '*');
}

// Add this function to handle the getCurrentTime response
window.addEventListener('message', function(event) {
if (event.source !== document.querySelector('#youtubeEmbed').contentWindow) return;

const data = JSON.parse(event.data);
if (data.event === 'getCurrentTime') {
const currentTime = data.info;
handleCurrentTime(currentTime);
}
});

function handleCurrentTime(currentTime) {
// Check for skip segments
const skipEnd = findEndTime(currentTime, skipSegments);
if (skipEnd) {
const iframe = document.querySelector('#youtubeEmbed');
iframe.contentWindow.postMessage(JSON.stringify({
event: 'command',
func: 'seekTo',
args: [skipEnd, true]
}), '*');
}

// Check for mute segments
const muteEnd = findEndTime(currentTime, muteSegments);
if (muteEnd) {
const iframe = document.querySelector('#youtubeEmbed');
iframe.contentWindow.postMessage(JSON.stringify({
event: 'command',
func: 'mute',
args: []
}), '*');
setTimeout(() => {
iframe.contentWindow.postMessage(JSON.stringify({
event: 'command',
func: 'unMute',
args: []
}), '*');
}, (muteEnd - currentTime) * 1000);
}
}

function findEndTime(now, map) {
let endTime
for (const startTime of map.keys()) {
if (
now + skipThreshold[0] >= startTime &&
now - startTime <= skipThreshold[1]
) { // within threshold
const segment = map.get(startTime)
endTime = segment.end
trackSkip(segment.uuid)
map.delete(startTime) // only use segment once
for (const overlapStart of map.keys()) {
// check for overlap
if (endTime >= overlapStart && overlapStart >= now) {
// move to end of overlaps
const overSegment = map.get(overlapStart)
endTime = overSegment.end
trackSkip(overSegment.uuid)
map.delete(overlapStart)
}
}
return endTime // early return
}
}
return endTime
}
function createPOILabel(poiLabel) {
createVideoLabel(poiLabel, "poi")
// add binding
const poi_listener = e => {
if (e.key === highlightKey) {
video.currentTime = poiLabel.segment[1]
trackSkip(poiLabel.UUID)
// remove label
document.querySelector("#sbjs-label-poi").style.display = "none"
document.removeEventListener("keydown", poi_listener)
}
}
document.addEventListener("keydown", poi_listener)
}
function createVideoLabel(videoLabel, type = "full") {
// await title
const title = document.querySelector("#title h1, h1.title.ytd-video-primary-info-renderer")
if (!title) {
setTimeout(createVideoLabel, 200, videoLabel)
return
}
const category = videoLabel.category
const fvString = category => `The entire video is ${category} and is too tightly integrated to be able to seperate`
const styles = {
// fg, bg, hover text
sponsor: ["#0d0", "#111", fvString("sponsor")],
selfpromo: ["#ff0", "#111", fvString("selfpromo")],
exclusive_access: ["#085", "#fff", "This video showcases a product, service or location that they've received free or subsidized access to"],
poi_highlight: ["#f18", "#fff", `Press ${highlightKey} to skip to the highlight`],
}
const style = styles[category]
const label = document.createElement("span")
label.title = style[2]
label.innerText = category
label.id = `sbjs-label-${type}`
label.style = `color: ${style[1]}; background-color: ${style[0]}; display: flex; margin: 0 5px;`
// prepend to title
title.style = "display: flex;"
title.prepend(label)
}

const reset = () => {
video = undefined
videoID = undefined
muteEndTime = 0
skipSegments = new Map()
muteSegments = new Map()
}

// reset on page change
document.addEventListener("yt-navigate-start", reset)
// will start setup once event listener fired
document.addEventListener("yt-navigate-finish", setup)
setup()
</script>
</body>
</html>