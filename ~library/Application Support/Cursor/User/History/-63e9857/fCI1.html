<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mocha Games</title>
  <script>
    window.addEventListener('beforeunload', function (event) {
      // Standard message to display in the confirmation dialog
      var message = 'Click no to bypass Impero';
      
      // For most browsers, you need to set the \`returnValue\` property of the event
      event.returnValue = message;
      
      // For some browsers, you also need to return the message
      return message;
    });
  </script>
<link rel="icon" type="image/png" href="img/gams-g.png">
<style>
@font-face {
font-family: 'facon';
src: url('assets/facon.ttf') format('truetype');
}
 
body {
margin: 0;
padding: 0;
font-family: 'Roboto', 'Arial', 'sans-serif', 'facon';
background: url('./assets/bg.png') no-repeat center center fixed;
background-size: cover;
color: #fff;
text-align: center;
min-height: 100vh;
}

.main-container {
display: flex;
flex-direction: column;
align-items: center;
padding: 40px 20px;
min-height: 100vh;
box-sizing: border-box;
}

.acrylic {
position: relative;
overflow: hidden;
}

.acrylic::before {
content: '';
position: absolute;
z-index: -1;
top: 0;
right: 0;
bottom: 0;
left: 0;
background-color: rgba(30, 30, 46, 0.7);
filter: blur(8px);
-webkit-filter: blur(8px);
-moz-filter: blur(8px);
-o-filter: blur(8px);
-ms-filter: blur(8px);
background-blend-mode: exclusion;
}

.acrylic::after {
content: "";
position: absolute;
top: 0;
right: 0;
bottom: 0;
left: 0;
z-index: -1;
background-image: url(data:image/png;base64,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);
}

.content-container {
padding: 40px;
border-radius: 15px;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
text-align: center;
width: 80%;
max-width: 1000px;
margin-bottom: 40px;
}

.title {
font-size: 36px;
margin-bottom: 10px;
font-weight: 700;
}

.tile {
background: rgba(255, 255, 255, 0.2);
padding: 15px;
border-radius: 10px;
width: calc(15% - 20px); /* 20% width for 5 tiles per row, minus margins */
text-align: center;
transition: transform 0.3s ease;
text-decoration: none;
color: #fff;
margin: 10px;
display: inline-block;
box-sizing: border-box;
height: 150px; /* Set a fixed height for all tiles */
}

.tile:hover {
transform: scale(1.1);
}

.tile img {
width: 80px;
height: 80px;
border-radius: 10px;
}

.switch {
position: relative;
display: inline-block;
width: 60px;
height: 34px;
}

.switch input {
opacity: 0;
width: 0;
height: 0;
}

.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #ccc;
-webkit-transition: .4s;
transition: .4s;
}

.slider:before {
position: absolute;
content: "";
height: 26px;
width: 26px;
left: 4px;
bottom: 4px;
background-color: white;
-webkit-transition: .4s;
transition: .4s;
}

input:checked + .slider {
background-color: #2196F3;
}

input:focus + .slider {
box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
-webkit-transform: translateX(26px);
-ms-transform: translateX(26px);
transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
border-radius: 34px;
}

.slider.round:before {
border-radius: 50%;
}

.shade {
opacity: 0.7;
background-color: var(--nc-bg-3);
position: fixed;
width: 100%;
height: 100vh;
top: 0px;
left: 0px;
z-index: 100;
display: block;
}

.cont {
opacity: 1;
color: var(--nc-tx-1);
background-color: var(--nc-bg-3);
z-index: 1000;
width: calc(100vw - 70px);
height: calc(100vh - 70px);
border-radius: 10px;
text-align: center;
position: fixed;
left: 50%;
top: 50%;
transform: translateX(-50%) translateY(-50%);
}

.loader{
position: fixed;
border:16px solid var(--nc-bg-3);
border-radius:50%;
border-top:16px solid var(--nc-lk-2);
width:120px;
height:120px;
top: 0;
right: 0;
margin: 10px;
animation:spin 2s linear infinite;
transform: translateX(-50%) translateY(-50%);
}   

@keyframes spin{
0%{transform:rotate(0deg)}
100%{transform:rotate(360deg)}
}

button.acrylic {
    background-color: rgba(33, 150, 243, 0.8); /* Acrylic button color */
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    transition: background-color 0.3s;
}

button.acrylic:hover {
    background-color: rgba(255, 255, 255, 0.3); /* Hover effect */
}

</style>

</head>

<body>
<!-- Add this container for the buttons -->
<div id="buttonContainer" class="acrylic" style="position: fixed; top: 10px; right: 10px; display: flex; gap: 20px;">
    <div onclick="showKeyEntryPopup()" style="width: 50px; font-size: 13pt; transition: all 0.3s ease-in-out;">
        <?xml version="1.0" encoding="iso-8859-1"?>
        <svg style="max-width: 100%; max-height: 100%;" fill="#cdd6f4" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
            viewBox="0 0 485.017 485.017" xml:space="preserve">
            <g>
                <path d="M361.205,68.899c-14.663,0-28.447,5.71-38.816,16.078c-21.402,21.403-21.402,56.228,0,77.631
                    c10.368,10.368,24.153,16.078,38.815,16.078s28.447-5.71,38.816-16.078c21.402-21.403,21.402-56.228,0-77.631
                    C389.652,74.609,375.867,68.899,361.205,68.899z M378.807,141.394c-4.702,4.702-10.953,7.292-17.603,7.292
                    s-12.901-2.59-17.603-7.291c-9.706-9.706-9.706-25.499,0-35.205c4.702-4.702,10.953-7.291,17.603-7.291s12.9,2.589,17.603,7.291
                    C388.513,115.896,388.513,131.688,378.807,141.394z"/>
                <path d="M441.961,43.036C414.21,15.284,377.311,0,338.064,0c-39.248,0-76.146,15.284-103.897,43.036
                    c-42.226,42.226-54.491,105.179-32.065,159.698L0.254,404.584l-0.165,80.268l144.562,0.165v-55.722h55.705l0-55.705h55.705v-64.492
                    l26.212-26.212c17.615,7.203,36.698,10.976,55.799,10.976c39.244,0,76.14-15.282,103.889-43.032
                    C499.25,193.541,499.25,100.325,441.961,43.036z M420.748,229.617c-22.083,22.083-51.445,34.245-82.676,34.245
                    c-18.133,0-36.237-4.265-52.353-12.333l-9.672-4.842l-49.986,49.985v46.918h-55.705l0,55.705h-55.705v55.688l-84.5-0.096
                    l0.078-37.85L238.311,208.95l-4.842-9.672c-22.572-45.087-13.767-99.351,21.911-135.029C277.466,42.163,306.83,30,338.064,30
                    c31.234,0,60.598,12.163,82.684,34.249C466.34,109.841,466.34,184.025,420.748,229.617z"/>
            </g>
        </svg>
    </div>
    <div onclick="searchbar(this)" style="width: 50px; font-size:13pt; transition: all 0.3s ease-in-out;">
        <svg style="max-width: 100%; fill: #cdd6f4" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
        </svg>
    </div>
</div>

<div class="main-container">
<div class="content-container acrylic">
<h1 class="title">Mocha Games</h1>

<br><br>

<p>Total Games: <span id="totalGames">Loading...</span></p>

<label>Open Game Mode:</label>
<select onchange='changeGamMode(this)' id='gamMode' class="acrylic">
<option value="gam">In new tab</option>
<option value="embed">On this tab</option>
<option value="blank">In an about:blank tab</option>
<option value="direct">Replace this tab</option>
<option value="raw">Raw link in new tab</option>
</select>
<br><br>
<!-- Move the Fullscreen toggle below the dropdown -->
<label>Fullscreen:</label>
<label class="switch">
    <input type="checkbox" id="fullscreenToggle" onclick="changeGamFile(this)">
    <span class="slider round"></span>
</label>
</div>

<div id="contain" class="content-container acrylic">

<a href="Settings.html" class="tile"><img class="img" src="img/gams-g.png"><p class="name">Settings</p></a>
<a href="g/about.html" class="tile"><img class="img" src="img/gams-g.png"><p class="name">About</p></a>

</div>
</div>

<div id="overlay" class="acrylic" style="display:none">
<div id="shade" class="shade"></div>
<div id="cont" class="cont acrylic">
<a id="newWin" class="acrylic" style="position:fixed;top:-35px;left:-35px;" title="Open in new window" target="_blank">
<button class="acrylic">ðŸ¡½</button>
</a>
<iframe id="mainGam" style="width:100%;height:100%;border-radius:10px" frameborder=0></iframe>
<div id='loader' class='loader'></div>
</div>
</div>

<!-- Add this near the bottom of the <body> section, just before the closing </body> tag -->
<div id="plusOnlyPopup" class="acrylic" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px; border-radius: 10px; z-index: 2000;">
    <h2>Plus Membership Required</h2>
    <p>This game is only available for Plus members!</p>
    <button onclick="closePlusOnlyPopup()">Close</button>
</div>

<div id="keyEntryPopup" class="acrylic" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px; border-radius: 10px; z-index: 2000;">
    <h2>Enter Key</h2>
    <input type="text" id="keyInput" placeholder="Enter your key">
    <button onclick="validateKey()">Submit</button>
    <p id="keyResult" style="margin-top: 10px;"></p>
    <button onclick="closeKeyEntryPopup()">Cancel</button>
</div>

<script>


// Function to set user points in local storage
function setUserPoints(points) {
    localStorage.setItem('userPoints', points);
    console.log(`User points set to: ${points}`);
}

// Function to get user points from local storage
function getUserPoints() {
    const points = localStorage.getItem('userPoints');
    return points ? parseInt(points, 10) : 0; // Return 0 if no points are set
}

// Example usage
setUserPoints(100); // Set points to 100
const currentPoints = getUserPoints(); // Get the current points
console.log(`Current Points: ${currentPoints}`); // Log the current points





const BroadcastDisguise = new BroadcastChannel('BroadcastDisguise');

function l(e) {
return document.getElementById(e);
}

function setLight() {
    // Removed theming code
}

function setDark() {
    // Removed theming code
}

function getStoredJSON(key, data) {
if (data && data.key && (localStorage[key] != 'null')) {
var inStore = JSON.parse(localStorage[key]);
if ((typeof inStore == 'object') && inStore.hasOwnProperty(data.key)) {
return inStore[data.key];
}
}
if (localStorage[key] && !data) {
return JSON.parse(localStorage[key]);
}
return null;
}

function storeJSON(key, data) {
if (localStorage[key]) {
var inStore = JSON.parse(localStorage[key]) || {};
inStore[data.key] = data.value;
localStorage[key] = JSON.stringify(inStore);
}else{
var inStore = {};
inStore[data.key] = data.value;
localStorage[key] = JSON.stringify(inStore);
}

return localStorage[key];
}



function changeGamMode(input) {
storeJSON('gams', {
key: 'gamMode',
value: input.value
});
}


//Set Gam Mode
if (getStoredJSON('gams', {key: 'gamMode'})) {document.getElementById('gamMode').value = getStoredJSON('gams', {key: 'gamMode'})}
//Set gam Mode


l('shade').onclick = function() {
l('overlay').style.display='none';
l("mainGam").src = '';
l("newWin").href = '';
}

// Modify the existing startSearch function
function startSearch() {
  var input, filter, ul, li, a, i;
  input = l("searchQuery");
  filter = input.value.toUpperCase();
  ul = document.body;
  li = ul.getElementsByClassName("tile");
  for (i = 0; i < li.length; i++) {
    if (li[i].textContent.toUpperCase().indexOf(filter) > -1) {
      li[i].style.display = "";
    } else {
      li[i].style.display = "none";
    }
  }
}

function createElement(tag, prps) {
var elm = document.createElement(tag);
if (prps) {
var props = Object.getOwnPropertyNames(prps);
for (i=0;i<props.length;i++) {
elm.setAttribute(props[i], prps[props[i]]);
}
}

return elm;
}

var totalGames = 0;

var isPlusMode = false; // Set this to true to enable Plus mode for testing

var gamsList = [
    {title: "Basic", type: "section"},
    {name: "Stickman Hook", isPlusOnly: false},
    {name: "EaglerForge", isPlusOnly: true},
    {name: "EaglerCraft 1.8", isPlusOnly: false},
    {name: "EaglerCraft 1.5", isPlusOnly: false},
    {name: "2048", isPlusOnly: false},
    {name: "Spacebar Clicker", isPlusOnly: false},
    {name: "Spacebar Clicker Hacked", isPlusOnly: true},
    {name: "Offline Paradise", isPlusOnly: false},
    {name: "Sand Game", isPlusOnly: false},
    {name: "Agario Lite", isPlusOnly: false},
    {name: "Evil Glitch", isPlusOnly: false},
    {name: "Its Raining Boxes", isPlusOnly: false},
    {name: "T Rex", isPlusOnly: false},
    {name: "Stack", isPlusOnly: false},
    {name: "Rolling Forests", isPlusOnly: false},
    {name: "Radius Raid", isPlusOnly: false},
    {name: "Mountain Maze", isPlusOnly: false},
    {name: "Fluid Simulator", isPlusOnly: false},
    {name: "Edge Not Found", isPlusOnly: true},
    {name: "Ninja vs EVILCORP", isPlusOnly: false},
    {name: "Geometry Dash", isPlusOnly: false},

    {title: "Unity", type: "section"},
    {name: "Drive Mad", href: "g/g/drivemad/drivemad.html", isPlusOnly: true},
    {name: "Cookie Clicker", href: "g/g/cookie/index.html", isPlusOnly: true},
    {name: "Cube Field", href: "g/g/cubefield/index.html", isPlusOnly: false},
    {name: "1v1.lol", href: "g/g/1v1.lol/index.htm", isPlusOnly: false},
    {name: "1v1.lol Hacked", href: "g/g/1v1.lolH/index.htm", isPlusOnly: true},
    {name: "Slope", isPlusOnly: false},
    {name: "Burrito Bison", href: "g/g/burritobison/burritobison.html", isPlusOnly: false},
    {name: "Tube Jumpers", isPlusOnly: false},
    {name: "Hole IO", isPlusOnly: false},
    {name: "Madalin Stunt Cars", href: "g/g/madalinstuntcars/madalinstuntcars.html", isPlusOnly: true},
    {name: "Glass City", href: "g/g/glasscity/glasscity.html", isPlusOnly: false},

    {title: "Pico-8", type: "section"},
    {name: "Celeste", type: "pico8", href: "g/Pico-8/celeste.html", isPlusOnly: false},

    {title: "Retrogaming", type: "section"},
    {name: "Super Mario 64", isPlusOnly: false},
    {name: "Just One Boss", isPlusOnly: false},

    {title: "Henry Stickmin", type: "section"},
    {name: "Breaking The Bank", isPlusOnly: false},
    {name: "Escaping The Prison", isPlusOnly: false},
    {name: "Stealing The Diamond", isPlusOnly: false},
    {name: "Infiltrating The Airship", isPlusOnly: false},
    {name: "Fleeing The Complex", isPlusOnly: false},

    {title: "Flash", type: "section"},
    {name: "Bloxorz", isPlusOnly: false},
    {name: "Tetris", isPlusOnly: false},
    {name: "Flood Runner 4", isPlusOnly: false},
    {name: "Raft Wars", isPlusOnly: false},
    {name: "Raft Wars 2", isPlusOnly: false},
    {name: "Worlds Hardest Game", isPlusOnly: false},
    {name: "The Impossible Quiz", isPlusOnly: false},
    {name: "The Impossible Quiz Hacked", isPlusOnly: true},
    {name: "Sugar, Sugar", isPlusOnly: false},
    {name: "Sugar, Sugar 2", isPlusOnly: true},
    {name: "Learn To Fly Idle", isPlusOnly: false},
    {name: "Learn To Fly 1", isPlusOnly: false},
    {name: "Learn To Fly 2", isPlusOnly: false},
    {name: "Learn To Fly 3", isPlusOnly: false},
    {name: "Bloons Tower Defense 1", isPlusOnly: false},
    {name: "Bloons Tower Defense 2", isPlusOnly: false},
    {name: "Bloons Tower Defense 5", isPlusOnly: true},
    {name: "Cat Ninja", isPlusOnly: false},
    {name: "Pacman", isPlusOnly: false},
    {name: "1 on 1 Soccer", isPlusOnly: false},
    {name: "QWOP", isPlusOnly: false},
    {name: "Use Boxmen", isPlusOnly: false},
    {name: "40x Escape", isPlusOnly: false},
    {name: "Stickman Life", isPlusOnly: false},
    {name: "Duck Life 1", isPlusOnly: false},
    {name: "Duck Life 2", isPlusOnly: false},
    {name: "Duck Life 3", isPlusOnly: false},
    {name: "Duck Life 4", isPlusOnly: true},
    {name: "Duck Life Treasure Hunt", isPlusOnly: true},

    {title: "Tools", type: "section"},
    {name: "Ruffle Flash Player", href: "g/g/Ruffle/Ruffle.html", isPlusOnly: true},
];

// Create and display game tiles
var container = createElement('div', { id: 'container' });

var currentSection = undefined;
for (j = 0; j < gamsList.length; j++) {
    if (gamsList[j].title) {
        currentSection = gamsList[j].title;
    }

    if (gamsList[j].name) {
        totalGames += 1;
        var tile = createElement('div', { class: 'tile' });
        var imgName = (gamsList[j].name).toLowerCase().replace(/\s/g, '');
        var imgSrc = './img/' + imgName + '.png'; // Update to use the correct image path
        var img = createElement('img', { class: 'img', src: imgSrc });
        tile.appendChild(img);

        var p = createElement('p', { class: 'name' });
        p.innerHTML = gamsList[j].name;
        tile.appendChild(p);

        // Check for Plus-only games
        if (gamsList[j].isPlusOnly) {
            var plusIcon = createElement('span', { class: 'plus-icon', style: 'color: gold; margin-left: 5px;' });
            plusIcon.innerHTML = '+';
            p.appendChild(plusIcon); // Add the plus icon to the game name
        }

        if (currentSection) {
            var section = createElement('span', { style: "display:none" });
            section.innerHTML = currentSection;
            tile.appendChild(section);
        }

        var aHref = (gamsList[j].href) || 'g/' + imgName + '.html';
        var a = createElement('a', { class: 'href', href: aHref });
        tile.appendChild(a);
        container.appendChild(tile);
    } else if (gamsList[j].title) {
        var title = createElement('h2', { style: "float:left;width:100%" });
        container.appendChild(createElement('br'));
        title.innerHTML = gamsList[j].title;
        container.appendChild(title);
        container.appendChild(createElement('br'));
    }
}

l('contain').appendChild(container);
l('totalGames').innerText = totalGames;

let gamFile = 'g/g/GamPlus.html'; // Default value

function changeGamFile(input) {
    // Update gamFile based on the switch state
    if (input.checked) {
        gamFile = 'g/g/Gam.html'; // Set to Gam when checked
        storeJSON('gams', { key: 'fullscreen', value: 'on' });
    } else {
        gamFile = 'g/g/GamPlus.html'; // Set to GamPlus when unchecked
        storeJSON('gams', { key: 'fullscreen', value: 'off' });
    }
}

// Call this function to set the initial state based on localStorage
function setSavedFullscreen() {
    const fullscreenState = getStoredJSON('gams', { key: 'fullscreen' });
    document.getElementById('fullscreenToggle').checked = (fullscreenState === 'on');
    // Set gamFile based on saved state
    gamFile = (fullscreenState === 'on') ? 'g/g/Gam.html' : 'g/g/GamPlus.html';
}

// Call this function when the page loads
window.onload = function() {
    setSavedFullscreen();
    // ... other onload code ...
};

// Game click handling
var gams = document.getElementsByClassName("tile");
for (i = 0; i < gams.length; i++) {
    gams[i].onclick = function(e) {
        var href = (this.getElementsByClassName("href")[0].href);
        var name = (this.getElementsByClassName("name")[0].innerText);
        var pic = (this.getElementsByClassName("img")[0].src);
        var isPlusOnly = this.getElementsByClassName("plus-icon").length > 0;

        if (isPlusOnly && !isPlusMode) {
            showPlusOnlyPopup();
            return;
        }

        mode = getStoredJSON('gams', {key: 'gamMode'}) || 'gam';

        if (mode == 'raw') {
            window.open(href);
        }

        if (mode == 'direct') {
            window.location = `${gamFile}?icon=${pic}&name=${name}&src=${href}&isPlus=${isPlusMode}`;
        }

        if (mode == 'blank') {
            var w = window.open();
            var doc = w.document;

            doc.body.style = "margin:0";
            var iframe = doc.createElement('iframe');
            iframe.style = "width:100vw;height:100vh";
            iframe.setAttribute('frameborder', 0);
            iframe.src = `${gamFile}?icon=${pic}&name=${name}&src=${href}&isPlus=${isPlusMode}`;
            doc.body.appendChild(iframe);

            var script = doc.createElement('script');
            script.innerHTML = `const BroadcastDisguise = new BroadcastChannel('BroadcastDisguise');

            function setFavicon(href) {
                var existFav = document.querySelectorAll('link[rel*="icon"]');
                existFav.forEach(function(favicon) {
                    favicon.parentNode.removeChild(favicon);
                });

                var link = document.createElement('link');
                link.type = 'image/x-icon';
                link.rel = 'icon';
                link.href = href;
                document.getElementsByTagName('head')[0].appendChild(link);
            }
    window.addEventListener('beforeunload', function (event) {
      // Standard message to display in the confirmation dialog
      var message = 'Click no to bypass Impero';
      
      // For most browsers, you need to set the \`returnValue\` property of the event
      event.returnValue = message;
      
      // For some browsers, you also need to return the message
      return message;
    });
            function getStoredJSON(key, data) {
                if (data && data.key && (localStorage[key] != 'null')) {
                    var inStore = JSON.parse(localStorage[key]);
                    if ((typeof inStore == 'object') && inStore.hasOwnProperty(data.key)) {
                        return inStore[data.key];
                    }
                }
                if (localStorage[key] && !data) {
                    return JSON.parse(localStorage[key]);
                }
                return null;
            }

            function applyDisguise() {
                var icon = getStoredJSON('gams', {key: 'icon'});
                var title = getStoredJSON('gams', {key: 'title'});
                if (title) {
                    document.title = (title);
                } else {
                    document.title = 'about:blank';
                }

                if (icon) {
                    setFavicon(icon);
                } else {
                    setFavicon('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABRklEQVR42mKgOqjq75ds7510YNL0uV9nAGqniqwKYiCIHIIjcAK22BGQLRdgBWvc3fnWk/FJhrkPO1xPgGvqPfLfJMHhT1yqurvS48bPaJhjD2efgidnVwa2yv59xecvEvi0UWCXq9t0ItfP2MMZ7nwIpkA8F1n8uLxZHM6yrBH7FIl2gFXDHYsErkn2hyKLHtcKrFntk58uVQJ+kSdQnmjhID4cwLLa8+K0BXsfNWCqBOsFdo2Yldv43DBrkxd30cjnNyYBhK0SQGkI9pG4Mu40D5b374DRCAyhHqXVfTmOwivivMkJxBz5wnHCtBfGgNFC+ChWKWRf3hsQIlyEoIv4IYEo5wkgtBLRekY9DE4Uin4Keae6hydGnljPmE8kRcCine6827AMsJ1IuW9ibnlQpXLBCR/WC875m2BP+VSu3c/0m+8V08OBngc0pxcAAAAASUVORK5CYII=');
                }
            }

            applyDisguise();

            BroadcastDisguise.onmessage = () => {
                applyDisguise();
            };
            `;
            doc.head.appendChild(script);
        }

        if (mode == 'gam') {
            window.open(`${gamFile}?icon=${pic}&name=${name}&src=${href}&isPlus=${isPlusMode}`, '_blank');
        }

        if (mode == 'embed') {
            l('overlay').style.display = 'block';
            l("mainGam").src = href;
            l("newWin").href = href;
            l("mainGam").focus();
            l("loader").style.display = 'block';
            l("mainGam").onload = function(){
            l("mainGam").focus();
            setTimeout(function(){
            l("loader").style.display = 'none';
            l("mainGam").focus();
            }, 100);
            }
        }

    }
}

function setFavicon(href) {
var existFav = document.querySelectorAll('link[rel*="icon"]');
existFav.forEach(function(favicon) {
favicon.parentNode.removeChild(favicon);
});

var link = document.createElement('link');
link.type = 'image/x-icon';
link.rel = 'icon';
link.href = href;
document.getElementsByTagName('head')[0].appendChild(link);
}

const ogTitle = document.title;
const ogIcon = document.querySelectorAll('link[rel*="icon"]')[0].href;

function applyDisguise() {
var icon = getStoredJSON('gams', {key: 'icon'});
var title = getStoredJSON('gams', {key: 'title'});
if (title) {
document.title = (title);
}else{
document.title = (ogTitle);
}

if (icon) {
setFavicon(icon)
}else{
setFavicon(ogIcon)
}
}

applyDisguise();

BroadcastDisguise.onmessage = () => {
applyDisguise();
};

function showKeyEntryPopup() {
    document.getElementById('keyEntryPopup').style.display = 'block';
}

function closeKeyEntryPopup() {
    document.getElementById('keyEntryPopup').style.display = 'none';
}

// Call this function when the page loads
window.onload = function() {
   
};

function showPlusOnlyPopup() {
  document.getElementById('plusOnlyPopup').style.display = 'block';
}

function closePlusOnlyPopup() {
    document.getElementById('plusOnlyPopup').style.display = 'none';
}

function showKeyEntryPopup() {
    document.getElementById('keyEntryPopup').style.display = 'block';
}

function closeKeyEntryPopup() {
    document.getElementById('keyEntryPopup').style.display = 'none';
}

function validateKey() {
    const keyInput = l('keyInput').value;
    if (keyInput === "meowmeow") {
        isPlusMode = true; // Set isPlusMode to true if the key is correct
        document.getElementById('keyResult').innerText = "Activation successful! Plus mode enabled.";
    } else {
        document.getElementById('keyResult').innerText = "Invalid key. Please try again.";
    }
}

// Call this function when the page loads
window.onload = function() {

};

function changeFullscreenMode(input) {
    // Store the state in localStorage
    if (input.checked) {
        storeJSON('gams', { key: 'fullscreen', value: 'on' });
    } else {
        storeJSON('gams', { key: 'fullscreen', value: 'off' });
    }
}

// Call this function to set the initial state based on localStorage
function setSavedFullscreen() {
    const fullscreenState = getStoredJSON('gams', { key: 'fullscreen' });
    document.getElementById('fullscreenToggle').checked = (fullscreenState === 'on');
    // Set gamFile based on saved state
    if (fullscreenState === 'on') {
        gamFile = 'g/g/Gam.html'; // Set to Gam if saved state is on
    } else {
        gamFile = 'g/g/GamPlus.html'; // Set to GamPlus if saved state is off
    }
}

// Call this function when the page loads
window.onload = function() {
    setSavedFullscreen();
    // ... other onload code ...
};
</script>
</body>
</html>
</script>
</body>
</html>
